#!/bin/bash

echo "=== CONFIGURACIÃ“N RAC PROVIDER EN AUTHENTIK (RECOMENDADO) ==="
echo "RAC Provider estÃ¡ especÃ­ficamente diseÃ±ado para aplicaciones como Guacamole"
echo ""
echo "ğŸ”— URL de Authentik: https://34.68.124.46:9443"
echo "ğŸ‘¤ Usuario Admin: akadmin"
echo "ğŸ” Password: Neogenesys123!!!"
echo ""

echo "PASO 1: Crear RAC Provider"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "1. Ve a: Applications â†’ Providers"
echo "2. Haz clic en 'Create'"
echo "3. Selecciona: 'RAC Provider'"
echo ""
echo "ConfiguraciÃ³n del Provider:"
echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
echo "â”‚ Name: Guacamole RAC Provider                     â”‚"
echo "â”‚ Authorization flow: default-authorization-flow   â”‚"
echo "â”‚ Connection expiry: hours=24                      â”‚"
echo "â”‚ Delete failing connections: âœ… MARCADO           â”‚"
echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
echo ""

echo "PASO 2: Crear AplicaciÃ³n"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "1. Ve a: Applications â†’ Applications"
echo "2. Haz clic en 'Create'"
echo "3. ConfiguraciÃ³n:"
echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
echo "â”‚ Name: Apache Guacamole RAC                       â”‚"
echo "â”‚ Slug: apache-guacamole-rac                       â”‚"
echo "â”‚ Provider: Guacamole RAC Provider                 â”‚"
echo "â”‚ Launch URL: http://34.68.124.46:8080/guacamole/  â”‚"
echo "â”‚ Open in new tab: âœ… MARCADO                      â”‚"
echo "â”‚ Icon (opcional): Upload logo si tienes           â”‚"
echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
echo ""

echo "PASO 3: Configurar Endpoints RAC"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "1. Ve a: Applications â†’ Providers â†’ Guacamole RAC Provider"
echo "2. Haz clic en la pestaÃ±a 'Endpoints'"
echo "3. Crea endpoints para tus conexiones RDP existentes:"
echo ""
echo "ENDPOINTS BASADOS EN TUS CONEXIONES ACTUALES:"
echo ""
echo "ğŸ–¥ï¸  Endpoint 1 - Windows Production:"
echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
echo "â”‚ Name: Windows Production                         â”‚"
echo "â”‚ Host: 100.95.223.18                             â”‚"
echo "â”‚ Protocol: RDP                                    â”‚"
echo "â”‚ Settings:                                        â”‚"
echo "â”‚   Port: 3389                                     â”‚"
echo "â”‚   Width: 1920                                    â”‚"
echo "â”‚   Height: 1080                                   â”‚"
echo "â”‚   Color depth: 32                               â”‚"
echo "â”‚   Username: \${user.username}                    â”‚"
echo "â”‚   Password: \${user.attributes.ldap_password}    â”‚"
echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
echo ""
echo "ğŸ–¥ï¸  Endpoint 2 - Windows Server Demo:"
echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
echo "â”‚ Name: Windows Server Demo                        â”‚"
echo "â”‚ Host: 192.168.1.100                             â”‚"
echo "â”‚ Protocol: RDP                                    â”‚"
echo "â”‚ Settings:                                        â”‚"
echo "â”‚   Port: 3389                                     â”‚"
echo "â”‚   Username: administrator                        â”‚"
echo "â”‚   Password: \${user.attributes.admin_password}   â”‚"
echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
echo ""
echo "ğŸ§ Endpoint 3 - Ubuntu Server SSH:"
echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
echo "â”‚ Name: Ubuntu Server SSH                          â”‚"
echo "â”‚ Host: 192.168.1.102                             â”‚"
echo "â”‚ Protocol: SSH                                    â”‚"
echo "â”‚ Settings:                                        â”‚"
echo "â”‚   Port: 22                                       â”‚"
echo "â”‚   Username: admin                                â”‚"
echo "â”‚   Password: \${user.attributes.ssh_password}     â”‚"
echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
echo ""
echo "ğŸ–¼ï¸  Endpoint 4 - Linux Desktop VNC:"
echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
echo "â”‚ Name: Linux Desktop VNC                          â”‚"
echo "â”‚ Host: 192.168.1.101                             â”‚"
echo "â”‚ Protocol: VNC                                    â”‚"
echo "â”‚ Settings:                                        â”‚"
echo "â”‚   Port: 5901                                     â”‚"
echo "â”‚   Password: \${user.attributes.vnc_password}     â”‚"
echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
echo ""

echo "PASO 4: Configurar Property Mappings"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "1. Ve a: Customization â†’ Property Mappings"
echo "2. Busca mappings de tipo 'RAC Provider'"
echo "3. Verifica que existan estos mappings esenciales:"
echo "   â€¢ authentik default RAC Mapping: Username"
echo "   â€¢ authentik default RAC Mapping: Password"
echo ""
echo "Si no existen, crÃ©alos:"
echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
echo "â”‚ Username Mapping:                                â”‚"
echo "â”‚   Name: RAC Username Mapping                     â”‚"
echo "â”‚   Type: RAC Provider                             â”‚"
echo "â”‚   Expression: user.username                      â”‚"
echo "â”‚                                                  â”‚"
echo "â”‚ Password Mapping:                                â”‚"
echo "â”‚   Name: RAC Password Mapping                     â”‚"
echo "â”‚   Type: RAC Provider                             â”‚"
echo "â”‚   Expression: user.attributes.get('ldap_password', '')  â”‚"
echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
echo ""

echo "PASO 5: Configurar LDAP para obtener passwords"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "1. Ve a: Directory â†’ Sources"
echo "2. Busca tu LDAP source existente"
echo "3. En 'Property mappings', asegÃºrate de incluir:"
echo "   â€¢ authentik default LDAP Mapping: password"
echo ""
echo "Si no existe, crÃ©alo:"
echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
echo "â”‚ Name: LDAP Password Mapping                      â”‚"
echo "â”‚ Type: LDAP Source                                â”‚"
echo "â”‚ LDAP Property: userPassword                      â”‚"
echo "â”‚ User Property: attributes.ldap_password          â”‚"
echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
echo ""

echo "PASO 6: Configurar Outpost"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "1. Ve a: Applications â†’ Outposts"
echo "2. Busca el outpost existente o crea uno nuevo"
echo "3. ConfiguraciÃ³n:"
echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
echo "â”‚ Name: authentik Embedded Outpost                 â”‚"
echo "â”‚ Type: RAC                                        â”‚"
echo "â”‚ Applications: Apache Guacamole RAC               â”‚"
echo "â”‚ Configuration:                                   â”‚"
echo "â”‚   authentik_host: https://34.68.124.46:9443     â”‚"
echo "â”‚   log_level: debug                               â”‚"
echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
echo ""

echo "PASO 7: Probar el Flujo SSO"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "1. Ve a la interfaz de usuario de Authentik: https://34.68.124.46:9443/if/user/"
echo "2. Ingresa credenciales: soporte@kolaboree.local / Neo123!!!"
echo "3. VerÃ¡s la aplicaciÃ³n 'Apache Guacamole RAC' en tu dashboard"
echo "4. Haz clic en la aplicaciÃ³n"
echo "5. DeberÃ­as ver los endpoints RDP disponibles"
echo "6. Haz clic en un endpoint para conectarte"
echo ""

echo "ğŸ’¡ VENTAJAS DE RAC PROVIDER:"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "âœ… DiseÃ±ado especÃ­ficamente para RDP/SSH/VNC"
echo "âœ… Maneja automÃ¡ticamente credenciales"
echo "âœ… No requiere configuraciÃ³n de Nginx"
echo "âœ… IntegraciÃ³n nativa con LDAP"
echo "âœ… Interfaz de usuario optimizada para conexiones remotas"
echo "âœ… GestiÃ³n centralizada de endpoints"
echo ""

echo "ğŸ”„ MIGRACIÃ“N DE CONEXIONES EXISTENTES:"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "Tus 7 conexiones RDP existentes en Guacamole se pueden:"
echo "â€¢ Mantener como estÃ¡n (acceso directo a Guacamole)"
echo "â€¢ Migrar a RAC Provider (acceso unificado vÃ­a Authentik)"
echo "â€¢ Usar ambos mÃ©todos simultÃ¡neamente"
echo ""

echo "ğŸš€ RECOMENDACIÃ“N:"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "RAC Provider es la mejor opciÃ³n para tu caso de uso porque:"
echo "1. Cumple exactamente tu requerimiento de SSO"
echo "2. Maneja automÃ¡ticamente las credenciales LDAP"
echo "3. Proporciona una interfaz unificada"
echo "4. Es mÃ¡s fÃ¡cil de configurar que Proxy Provider"
echo ""

echo "âœ… PRÃ“XIMO PASO:"
echo "Configura RAC Provider siguiendo esta guÃ­a paso a paso"